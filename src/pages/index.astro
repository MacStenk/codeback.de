---
// ═══════════════════════════════════════════════════════
// HOMEPAGE - TinaCMS Blocks System
// ═══════════════════════════════════════════════════════
// Template-ready blocks-based homepage
// All content managed via TinaCMS
// ═══════════════════════════════════════════════════════

import "../styles/global.css";
import { getEntry } from 'astro:content';
import SEO from "../components/SEO.astro";
import Header from "../components/layout/Header.astro";
import Footer from "../components/Footer.astro";
import Hero from "../components/sections/Hero.astro";
import TargetAudience from "../components/sections/TargetAudience.astro";
import LiveDemo from "../components/sections/LiveDemo.astro";
import ProblemSection from "../components/sections/ProblemSection.astro";
import ConceptSection from "../components/sections/ConceptSection.astro";
import PricingSection from "../components/sections/PricingSection.astro";
import FutureSection from "../components/sections/FutureSection.astro";
import TechStack from "../components/sections/TechStack.astro";
import CTASection from "../components/sections/CTASection.astro";
import FAQSection from "../components/sections/FAQSection.astro";

// Load homepage data from TinaCMS
const homepage = await getEntry('homepage', 'index');
const blocks = homepage?.data?.blocks || [];
const pageTitle = homepage?.data?.title || "Codeback. Websites die Antworten werden";
const pageDescription = homepage?.data?.description || "LLM SEO und Answer Engine Optimization für die Zukunft der digitalen Sichtbarkeit";

// Component mapping for blocks
const blockComponents: Record<string, any> = {
  hero: Hero,
  targetAudience: TargetAudience,
  liveDemo: LiveDemo,
  problem: ProblemSection,
  concept: ConceptSection,
  pricing: PricingSection,
  future: FutureSection,
  techStack: TechStack,
  faq: FAQSection,
  cta: CTASection,
};
---

<!doctype html>
<html lang="de">
  <head>
    <SEO
      title={pageTitle}
      description={pageDescription}
      canonical="https://codeback.de"
      type="website"
    />

    <!-- Schema.org für LLMs -->
    <script
      type="application/ld+json"
      set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "WebSite",
        name: "CodeBack",
        url: "https://codeback.de",
        description: pageDescription,
        author: {
          "@type": "Person",
          name: "Steven Noack",
          url: "https://stevennoack.de",
        },
        about: {
          "@type": "Service",
          name: "LLM-native Web Development",
          description:
            "Entwicklung von Websites die für Large Language Models optimiert sind",
        },
      })}
    />
  </head>

  <body class="bg-white text-zinc-900">
    <Header />

    <main id="main-content" class="max-w-4xl mx-auto px-6 py-20">
      <article>
        <!-- ═══════════════════════════════════════════════════════════════
             PHASE 1: Only render props-based components (Hero & TargetAudience)
             Other components will be converted in Phase 2
             ═══════════════════════════════════════════════════════════════ -->
        {blocks
          .filter((block: any) => ['hero', 'targetAudience'].includes(block._template))
          .map((block: any) => {
            const Component = blockComponents[block._template];
            if (!Component) {
              console.warn(`No component found for block template: ${block._template}`);
              return null;
            }
            return <Component data={block} />;
          })}

        <!-- ═══════════════════════════════════════════════════════════════
             TEMPORARY: Static components until Phase 2 conversion
             ═══════════════════════════════════════════════════════════════ -->
        <LiveDemo />
        <ProblemSection />
        <ConceptSection />
        <PricingSection />
        <FutureSection />
        <TechStack />
        <FAQSection />
        <CTASection />
      </article>
    </main>

    <Footer />
  </body>
</html>
