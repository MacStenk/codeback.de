---
import type { CollectionEntry } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/layout/Header.astro";
import Breadcrumbs from "../components/layout/Breadcrumbs.astro";
import Footer from "../components/Footer.astro";
import FormattedDate from "../components/FormattedDate.astro";
import ReadingTime from "../components/ReadingTime.astro";
import TableOfContents from "../components/TableOfContents.astro";
import "../styles/global.css";

type Props = CollectionEntry<"blog">["data"] & {
  body?: string;
};

const {
  title,
  description,
  pubDate,
  updatedDate,
  heroImage,
  body = "",
} = Astro.props;

// Breadcrumbs
const breadcrumbs = [
  { label: "Home", href: "/" },
  { label: "Blog", href: "/blog" },
  { label: title },
];
---

<!doctype html>
<html lang="de">
  <head>
    <BaseHead title={title} description={description} />

    <!-- Schema.org für Author & Article -->
    <script
      type="application/ld+json"
      set:html={JSON.stringify({
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        headline: title,
        description: description,
        datePublished: pubDate,
        dateModified: updatedDate || pubDate,
        author: {
          "@type": "Person",
          name: "Steven Noack",
          url: "https://stevennoack.de",
          sameAs: [
            "https://linkedin.com/in/stevennoack",
            "https://github.com/stevennoack",
          ],
          jobTitle: "LLM-SEO Expert & Developer",
          worksFor: {
            "@type": "Organization",
            name: "CodeBack",
            url: "https://codeback.de",
          },
        },
        publisher: {
          "@type": "Organization",
          name: "CodeBack",
          url: "https://codeback.de",
        },
      })}
    />
  </head>

  <body class="bg-white text-zinc-900">
    <!-- Header Component -->
    <Header />

    <main class="max-w-7xl mx-auto px-6 py-12">
      <!-- Breadcrumbs -->
      <Breadcrumbs items={breadcrumbs} />

      <!-- 2-Column Layout: Content + Sidebar -->
      <div class="grid grid-cols-1 lg:grid-cols-[1fr_300px] gap-12">
        <!-- Main Content Column -->
        <article>
          <!-- Article Header -->
          <header class="mb-12">
            <!-- Meta: Date + Reading Time -->
            <div class="flex items-center gap-4 mb-4">
              <time class="text-sm text-zinc-500">
                <FormattedDate date={pubDate} />
              </time>
              <span class="text-zinc-300">•</span>
              <ReadingTime content={body} />

              {
                updatedDate && (
                  <>
                    <span class="text-zinc-300">•</span>
                    <div class="text-sm text-zinc-500 italic">
                      Aktualisiert: <FormattedDate date={updatedDate} />
                    </div>
                  </>
                )
              }
            </div>

            <h1 class="text-4xl md:text-5xl font-bold mb-6 leading-tight">
              {title}
            </h1>

            {
              description && (
                <p class="text-xl text-zinc-600 mb-8">{description}</p>
              )
            }

            <!-- Autor Box -->
            <div
              class="bg-zinc-50 border border-zinc-200 rounded-lg p-6 flex items-start gap-4"
            >
              <div
                class="w-12 h-12 bg-green-600 rounded-full flex items-center justify-center text-white font-bold text-xl flex-shrink-0"
              >
                SN
              </div>
              <div>
                <div class="font-semibold text-zinc-900">Steven Noack</div>
                <div class="text-sm text-zinc-600 mb-2">
                  LLM-SEO Expert · Privacy AI OS · 29+ Jahre Internet Business
                </div>
                <a
                  href="https://stevennoack.de"
                  target="_blank"
                  rel="author"
                  class="text-sm text-green-600 hover:text-green-700 font-medium"
                >
                  stevennoack.de →
                </a>
              </div>
            </div>
          </header>

          <!-- Hero Image (optional) -->
          {
            heroImage && (
              <div class="mb-12">
                <img
                  src={heroImage.src}
                  alt={title}
                  class="w-full rounded-lg border border-zinc-200"
                />
              </div>
            )
          }

          <!-- Article Content -->
          <div class="article-content prose prose-zinc prose-lg max-w-none">
            <slot />
          </div>

          <!-- Back to Blog -->
          <footer class="mt-16 pt-8 border-t border-zinc-200">
            <a
              href="/blog"
              class="inline-flex items-center gap-2 text-zinc-600 hover:text-zinc-900 font-medium"
            >
              ← Zurück zum Blog
            </a>
          </footer>
        </article>

        <!-- Sidebar with TOC (Desktop only) -->
        <TableOfContents />
      </div>
    </main>

    <Footer />
  </body>
</html>
